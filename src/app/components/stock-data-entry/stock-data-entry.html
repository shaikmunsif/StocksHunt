<div
  class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:bg-gray-900 py-8 transition-colors duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div
      class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-6 mb-6 transition-colors duration-300"
    >
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Stock Data Entry</h1>
      <p class="text-gray-600 dark:text-gray-400">
        Paste tab-separated table data, select exchange and date to parse, display, and save stock
        information to database
      </p>
    </div>

    <!-- Input Section -->
    @if (!showData) {
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-6 mb-6 transition-colors duration-300"
      >
        <div class="space-y-4">
          <!-- Exchange and Date Row -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Exchange Input -->
            <div>
              <label
                for="exchangeSelect"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Exchange
              </label>
              <select
                id="exchangeSelect"
                [(ngModel)]="selectedExchange"
                class="w-full px-3 py-3 h-12 sm:h-auto text-base sm:text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"
              >
                <option value="NSE">NSE (National Stock Exchange)</option>
                <option value="BSE">BSE (Bombay Stock Exchange)</option>
              </select>
            </div>

            <!-- Date Input -->
            <div>
              <label
                for="dateInput"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Date
              </label>
              <input
                type="date"
                id="dateInput"
                [(ngModel)]="dateInput"
                class="w-full px-3 py-3 h-12 sm:h-auto text-base sm:text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"
              />
            </div>
          </div>

          <!-- Table Data Input -->
          <div>
            <label
              for="tableInput"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Table Data (Tab-separated) - {{ selectedExchange }}
            </label>
            <textarea
              id="tableInput"
              [(ngModel)]="tableInput"
              placeholder="Paste table data here. First row should contain headers like: Company	Change Percent	Current Price	Last 1 Days Price"
              rows="10"
              class="w-full px-3 py-3 text-base sm:text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono transition-colors duration-200"
            ></textarea>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              Format: Tab-separated values with headers in first row • Exchange:
              {{ selectedExchange }}
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-3">
            <button
              (click)="parseAndDisplayData()"
              class="w-full sm:w-auto px-6 py-3 min-h-[48px] text-base sm:text-sm bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition-colors duration-200"
            >
              Parse & Display Data
            </button>
            <button
              (click)="saveToDatabase()"
              [disabled]="isSaving"
              class="w-full sm:w-auto px-6 py-3 min-h-[48px] text-base sm:text-sm bg-green-600 text-white font-medium rounded-md hover:bg-green-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              @if (!isSaving) {
                <span>Save to Database</span>
              } @else {
                <span>Saving {{ saveProgress }}%...</span>
              }
            </button>
            <button
              (click)="clearData()"
              class="w-full sm:w-auto px-6 py-3 min-h-[48px] text-base sm:text-sm bg-gray-300 text-gray-700 font-medium rounded-md hover:bg-gray-400 transition-colors duration-200"
            >
              Clear
            </button>
          </div>

          <!-- Save Progress Indicator -->
          @if (isSaving && saveProgress > 0) {
            <div class="mt-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-600 dark:text-gray-400">{{ saveProgressMessage }}</span>
                <span class="text-sm font-semibold text-blue-600 dark:text-blue-400">{{ saveProgress }}%</span>
              </div>
              <div
                class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5"
                role="progressbar"
                [attr.aria-valuenow]="saveProgress"
                aria-valuemin="0"
                aria-valuemax="100"
                [attr.aria-label]="'Save progress: ' + saveProgress + '%'"
              >
                <div
                  class="bg-green-600 h-2.5 rounded-full transition-all duration-300"
                  [style.width.%]="saveProgress"
                ></div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Results Section -->
    @if (showData) {
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4 sm:p-6 transition-colors duration-300"
      >
        <!-- Results Header - Mobile Responsive -->
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-6">
          <div>
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">Parsed Stock Data</h2>
            @if (stockData.date) {
              <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 mt-1">
                <span class="inline-flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  {{ stockData.date | date : 'mediumDate' }}
                </span>
                <span class="mx-2">•</span>
                <span class="font-medium">{{ selectedExchange }}</span>
              </p>
            }
            <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400">
              Total Stocks: <span class="font-semibold text-blue-600 dark:text-blue-400">{{ stockData.stocks.length }}</span>
            </p>
          </div>
          <!-- Action Buttons - Stack on mobile -->
          <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
            <button
              (click)="saveToDatabase()"
              [disabled]="isSaving"
              class="w-full sm:w-auto px-4 py-3 sm:py-2 min-h-[48px] sm:min-h-0 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 text-white font-medium rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-sm"
            >
              @if (!isSaving) {
                <span>Save to Database</span>
              } @else {
                <span>Saving {{ saveProgress }}%...</span>
              }
            </button>
            <button
              (click)="clearData()"
              class="w-full sm:w-auto px-4 py-3 sm:py-2 min-h-[48px] sm:min-h-0 bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white font-medium rounded-md transition-colors duration-200 text-base sm:text-sm"
            >
              Clear & Start Over
            </button>
          </div>
        </div>

      <!-- Save Progress Indicator -->
      @if (isSaving && saveProgress > 0) {
        <div class="mb-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-600 dark:text-gray-400">{{ saveProgressMessage }}</span>
            <span class="text-sm font-semibold text-blue-600 dark:text-blue-400">{{ saveProgress }}%</span>
          </div>
          <div
            class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5"
            role="progressbar"
            [attr.aria-valuenow]="saveProgress"
            aria-valuemin="0"
            aria-valuemax="100"
            [attr.aria-label]="'Save progress: ' + saveProgress + '%'"
          >
            <div
              class="bg-green-600 h-2.5 rounded-full transition-all duration-300"
              [style.width.%]="saveProgress"
            ></div>
          </div>
        </div>
      }

      <!-- Save Message -->
      @if (saveMessage) {
        <div
          [class]="
            saveMessage.includes('success')
              ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200'
              : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200'
          "
          class="border rounded-md p-4 mb-6 transition-colors duration-300"
        >
          {{ saveMessage }}
        </div>
      }

      <!-- Mobile Card View -->
      <div class="mobile-card-view">
        @if (stockData.stocks.length) {
          @for (stock of stockData.stocks; track stock.symbol; let i = $index) {
            <div 
              class="mobile-stock-card"
              [class.mobile-card-high-gain]="stock.changePercent > 10"
              [class.mobile-card-medium-gain]="stock.changePercent > 5 && stock.changePercent <= 10"
              [class.expanded]="expandedCards[stock.symbol]"
            >
              <!-- Card Header -->
              <div class="mobile-card-header" (click)="toggleCardExpand(stock.symbol)">
                <div class="mobile-card-title-row">
                  <span class="mobile-stock-symbol">{{ stock.symbol }}</span>
                  <span 
                    class="mobile-change-badge"
                    [class.high-gain]="stock.changePercent > 10"
                    [class.medium-gain]="stock.changePercent > 5 && stock.changePercent <= 10"
                    [class.normal-gain]="stock.changePercent <= 5"
                  >
                    +{{ stock.changePercent.toFixed(2) }}%
                  </span>
                </div>
                <p class="mobile-company-name">{{ stock.company }}</p>
                <div class="expand-indicator">
                  <svg 
                    class="w-5 h-5 text-gray-400 transition-transform duration-200" 
                    [class.rotate-180]="expandedCards[stock.symbol]"
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </div>
              </div>

              <!-- Expandable Card Body -->
              <div class="mobile-card-body" [class.show]="expandedCards[stock.symbol]">
                <div class="mobile-card-row">
                  <span class="mobile-card-label">Current Price</span>
                  <span class="mobile-card-value">₹{{ formatPrice(stock.currentPrice) }}</span>
                </div>
                <div class="mobile-card-row">
                  <span class="mobile-card-label">Last Day Price</span>
                  <span class="mobile-card-value">₹{{ formatPrice(stock.lastDayPrice) }}</span>
                </div>
                <div class="mobile-card-row">
                  <span class="mobile-card-label">Price Change</span>
                  <span class="mobile-card-value text-green-600 dark:text-green-400">
                    +₹{{ formatPrice(stock.currentPrice - stock.lastDayPrice) }}
                  </span>
                </div>
              </div>

              <!-- Swipe to Delete Action -->
              <div class="mobile-card-actions">
                <button 
                  (click)="removeStock(i)"
                  class="mobile-delete-btn"
                  title="Remove stock"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                  <span>Remove</span>
                </button>
              </div>
            </div>
          }
        } @else {
          <div class="mobile-empty-state">
            <svg class="mobile-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v1a1 1 0 001 1h4a1 1 0 001-1v-1m3-2V8a2 2 0 00-2-2H8a2 2 0 00-2 2v6m0 0h12"></path>
            </svg>
            <h3 class="mt-2 text-base font-medium text-gray-900 dark:text-white">No stock data found</h3>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Please check your input format and try again</p>
          </div>
        }
      </div>

      <!-- Desktop Table View -->
      <div class="desktop-table-view overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Company Name
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Symbol
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Change %
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Current Price
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Last Day Price
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            @for (stock of stockData.stocks; track stock.symbol; let i = $index) {
            <tr
              class="hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-150"
              [class.bg-green-100]="stock.changePercent > 10"
              [class.dark:bg-green-900/20]="stock.changePercent > 10"
              [class.bg-green-50]="stock.changePercent > 5 && stock.changePercent <= 10"
              [class.dark:bg-green-900/10]="stock.changePercent > 5 && stock.changePercent <= 10"
            >
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ stock.company }}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200"
                >
                  {{ stock.symbol }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="text-sm"
                  [class.text-green-700]="stock.changePercent > 10"
                  [class.font-bold]="stock.changePercent > 10"
                  [class.text-green-600]="stock.changePercent > 5 && stock.changePercent <= 10"
                  [class.font-semibold]="stock.changePercent > 5 && stock.changePercent <= 10"
                  [class.text-green-500]="stock.changePercent <= 5"
                >
                  +{{ stock.changePercent.toFixed(2) }}%
                </span>
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 font-mono"
              >
                ₹{{ formatPrice(stock.currentPrice) }}
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 font-mono"
              >
                ₹{{ formatPrice(stock.lastDayPrice) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button
                  (click)="removeStock(i)"
                  class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition-colors duration-200"
                  title="Remove stock"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      @if (stockData.stocks.length === 0) {
        <div class="hidden lg:block text-center py-12">
          <div class="text-gray-500 dark:text-gray-400 text-lg">No stock data found</div>
          <p class="text-gray-400 dark:text-gray-500 mt-2">
            Please check your input format and try again
          </p>
        </div>
      }
    </div>

    <!-- Scroll to Top Button -->
    @if (showScrollTop) {
      <button
        (click)="scrollToTop()"
        class="fixed bottom-6 right-6 z-50 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg transition-all duration-300 lg:hidden"
        aria-label="Scroll to top"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
      </button>
    }
  }
  </div>
</div>
